<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ç¥¨æ•°ç»Ÿè®¡å¤§å±å¹•</title>
	<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

		@font-face {
			font-family: 'DSEG7Classic';
			src: url('https://cdn.jsdelivr.net/npm/dseg7@0.0.1/dist/dseg7classic.woff2') format('woff2'),
				 url('https://cdn.jsdelivr.net/npm/dseg7@0.0.1/dist/dseg7classic.woff') format('woff');
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
			background: linear-gradient(135deg, rgb(26, 35, 38) 0%, rgb(30, 39, 42) 50%, rgb(28, 37, 40) 100%);
			color: white;
			overflow: hidden;
			width: 100vw;
			height: 100vh;
			position: relative;
		}

		body::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background:
				radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.03) 0%, transparent 40%),
				radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.02) 0%, transparent 40%);
			pointer-events: none;
			z-index: 0;
		}

		.container {
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			position: relative;
			padding-top: 40px;
			gap: 24px;
			z-index: 1;
			transform: scale(0.88);
			transform-origin: top center;
		}

		.container::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background:
				radial-gradient(ellipse 800px 600px at 20% 30%, rgba(255, 255, 255, 0.04) 0%, transparent 50%),
				radial-gradient(ellipse 600px 800px at 80% 70%, rgba(255, 255, 255, 0.03) 0%, transparent 50%),
				radial-gradient(ellipse 400px 400px at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
			pointer-events: none;
			z-index: 0;
		}

		/* é¡¶éƒ¨æ¡çŠ¶æ˜¾ç¤ºåŒºåŸŸ */
		.header {
			width: 100%;
			height: 110px;
			display: flex;
			position: relative;
			overflow: hidden;
			margin-bottom: 20px;
		}

		/* æ­£æ–¹åŒºåŸŸï¼ˆå·¦ä¾§çº¢è‰²ï¼‰ */
		.header-left {
			height: 100%;
			background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
			display: flex;
			flex-direction: row;
			align-items: center;
			justify-content: space-between;
			position: relative;
			transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
			padding: 0 30px;
		}

		.header-left::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(255, 255, 255, 0.05);
			pointer-events: none;
		}

		/* åæ–¹åŒºåŸŸï¼ˆå³ä¾§è“è‰²ï¼‰ */
		.header-right {
			height: 100%;
			background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
			display: flex;
			flex-direction: row;
			align-items: center;
			justify-content: space-between;
			position: relative;
			transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
			padding: 0 30px;
		}

		.header-right::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(255, 255, 255, 0.05);
			pointer-events: none;
		}

		/* é¡¶éƒ¨æ ‡ç­¾æ–‡å­— */
		.header-label {
			font-size: 32px;
			font-weight: 900;
			color: white;
			text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
			position: relative;
			z-index: 1;
			border: 2px solid rgba(255, 255, 255, 0.9);
			padding: 6px 18px;
			border-radius: 8px;
			background: rgba(255, 255, 255, 0.1);
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		/* è¿›åº¦æ¡ä¸­çš„ç¥¨æ•°æ˜¾ç¤º */
		.header-vote-value {
			font-size: 48px;
			font-weight: 900;
			color: white;
			text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
			position: relative;
			z-index: 1;
			line-height: 1;
			transition: transform 0.3s ease;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.header-vote-value.updated {
			animation: numberUpdate 0.5s ease;
		}

		@keyframes numberUpdate {
			0% { transform: scale(1); }
			50% { transform: scale(1.15); }
			100% { transform: scale(1); }
		}

		/* è¿›åº¦æ¡ä¸­çš„ç™¾åˆ†æ¯”æ˜¾ç¤º */
		.header-vote-percentage {
			font-size: 24px;
			font-weight: 700;
			color: rgba(255, 255, 255, 0.95);
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
			position: relative;
			z-index: 1;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.header-center-content {
			display: flex;
			flex-direction: row;
			align-items: center;
			gap: 12px;
		}

		/* é¡¶éƒ¨ä¸­é—´åˆ†éš”çº¿ */
		.header-divider {
			position: absolute;
			left: 50%;
			top: 0;
			bottom: 0;
			width: 3px;
			background: rgba(255, 255, 255, 0.9);
			box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
			z-index: 10;
			transform: translateX(-50%);
		}

		/* æµä¿¡æ¯ï¼ˆå³ä¸‹è§’å°æ ‡ç­¾ï¼‰ */
		.stream-info {
			position: fixed;
			bottom: 20px;
			right: 20px;
			font-size: 12px;
			color: rgba(255, 255, 255, 0.9);
			background: rgba(0, 0, 0, 0.4);
			padding: 5px 10px;
			border-radius: 12px;
			display: flex;
			align-items: center;
			gap: 5px;
			cursor: pointer;
			transition: background 0.3s ease;
			z-index: 1000;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.stream-info:hover {
			background: rgba(0, 0, 0, 0.6);
		}

		.stream-info.collapsed {
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.3s ease;
		}

		.status-indicator {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: #95a5a6;
			animation: pulse 2s infinite;
		}

		.status-indicator.live {
			background: #27ae60;
		}

		@keyframes pulse {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.5; }
		}

		/* è®¡æ—¶å™¨å’Œç¯èŠ‚æ§åˆ¶åŒºåŸŸ */
		.timer-section {
			width: 100%;
			padding: 32px 40px;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 20px;
		}

		.timer-wrapper {
			width: 100%;
			max-width: 960px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 36px;
		}

		.timer-info {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 16px;
			flex: 0 1 auto;
			text-align: center;
		}

		.timer-actions {
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			gap: 12px;
			display: none;
		}

		.segment-info {
			font-size: 42px;
			font-weight: 900;
			color: white;
			text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
			text-align: center;
			letter-spacing: 2px;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.timer-display {
			font-size: 160px;
			font-weight: 300;
			color: #ffffff;
			font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', 'Courier New', monospace;
			letter-spacing: 12px;
			font-variant-numeric: tabular-nums;
		}

		.timer-display.warning {
			color: #ff6b6b;
		}

		.timer-controls {
			display: flex;
			gap: 16px;
			align-items: center;
			justify-content: flex-start;
		}

		.timer-btn {
			padding: 12px 26px;
			font-size: 15px;
			font-weight: 600;
			border: 1.5px solid rgba(255, 255, 255, 0.3);
			border-radius: 8px;
			background: rgba(255, 255, 255, 0.1);
			color: white;
			cursor: pointer;
			transition: all 0.3s ease;
			backdrop-filter: blur(10px);
		}

		.timer-btn:hover {
			background: rgba(255, 255, 255, 0.2);
			border-color: rgba(255, 255, 255, 0.5);
			transform: translateY(-2px);
		}

		.timer-btn:active {
			transform: translateY(0);
		}

		.timer-btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.timer-btn.primary {
			background: rgba(52, 152, 219, 0.3);
			border-color: rgba(52, 152, 219, 0.6);
		}

		.timer-btn.primary:hover {
			background: rgba(52, 152, 219, 0.5);
		}

		.timer-btn.danger {
			background: rgba(231, 76, 60, 0.3);
			border-color: rgba(231, 76, 60, 0.6);
		}

		.timer-btn.danger:hover {
			background: rgba(231, 76, 60, 0.5);
		}

		.segment-controls {
			display: flex;
			gap: 16px;
			align-items: center;
			justify-content: flex-start;
		}

		/* ä¸»å†…å®¹åŒº */
		.main-content {
			width: 100%;
			display: flex;
			align-items: stretch;
			justify-content: center;
			padding: 0 40px;
			position: relative;
		}

		/* ç¥¨æ•°æ˜¾ç¤ºåŒºåŸŸ */
		.votes-display {
			width: 100%;
			max-width: 1400px;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 30px;
		}

		/* è¯„å§”ç¥¨æ•°åŒºåŸŸ */
		.judges-section {
			width: 100%;
			padding: 10px 40px 30px;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 24px;
		}

		.judges-title {
			font-size: 26px;
			font-weight: 700;
			color: white;
			text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.45);
			letter-spacing: 2px;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.judges-list {
			width: 100%;
			max-width: 1200px;
			display: flex;
			gap: 24px;
			align-items: stretch;
			justify-content: center;
		}

		.judge-card {
			flex: 1 1 0;
			min-width: 220px;
			background: rgba(255, 255, 255, 0.06);
			border: 1px solid rgba(255, 255, 255, 0.12);
			border-radius: 18px;
			padding: 20px 24px;
			display: flex;
			gap: 18px;
			align-items: center;
			box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
			transition: transform 0.3s ease, background 0.3s ease;
		}

		.judge-card:hover {
			transform: translateY(-6px);
			background: rgba(255, 255, 255, 0.1);
		}

		.judge-avatar {
			width: 88px;
			height: 88px;
			border-radius: 50%;
			border: 3px solid rgba(255, 255, 255, 0.35);
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
			flex-shrink: 0;
			overflow: hidden;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.judge-info {
			display: flex;
			flex-direction: column;
			gap: 8px;
			color: white;
			flex: 1;
		}

		.judge-name {
			font-size: 20px;
			font-weight: 700;
			letter-spacing: 1px;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.judge-role {
			font-size: 14px;
			color: rgba(255, 255, 255, 0.65);
			letter-spacing: 0.5px;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.judge-votes {
			margin-top: 6px;
			display: flex;
			align-items: baseline;
			gap: 10px;
		}

		.judge-votes .label {
			font-size: 14px;
			color: rgba(255, 255, 255, 0.7);
			letter-spacing: 1px;
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.judge-votes .value {
			font-size: 32px;
			font-weight: 800;
			color: #f5b041;
			text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
			font-family: 'KaiTi', 'Kaiti SC', 'STKaiti', 'Adobe Kaiti Std', 'æ¥·ä½“', 'KaiTi_GB2312', serif;
		}

		.judge-votes .value.updated {
			animation: numberUpdate 0.5s ease;
		}

		/* æ€»ç¥¨æ•°æ˜¾ç¤º */
		.total-votes {
			text-align: center;
			background: rgba(0, 0, 0, 0.4);
			padding: 20px 40px;
			border-radius: 16px;
			font-size: 26px;
			font-weight: 600;
			backdrop-filter: blur(10px);
			border: 2px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
		}

		.total-label {
			font-size: 20px;
			opacity: 0.9;
			margin-right: 12px;
			color: rgba(255, 255, 255, 0.8);
		}

		.total-value {
			font-size: 36px;
			font-weight: 700;
			color: #f39c12;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		}

		/* åŠ è½½çŠ¶æ€ */
		.loading {
			text-align: center;
			font-size: 20px;
			color: rgba(255, 255, 255, 0.6);
		}

		/* é”™è¯¯çŠ¶æ€ */
		.error {
			text-align: center;
			font-size: 20px;
			color: #e74c3c;
			padding: 30px;
		}

		/* æ§åˆ¶é¢æ¿ï¼ˆå³ä¸‹è§’ï¼Œå¯é€‰ï¼‰ */
		.control-panel {
			position: fixed;
			bottom: 80px;
			right: 20px;
			background: rgba(0, 0, 0, 0.7);
			padding: 16px;
			border-radius: 10px;
			backdrop-filter: blur(10px);
			display: none;
			z-index: 1000;
			border: 1px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
		}

		.control-panel.show {
			display: block;
		}

		.control-panel label {
			display: block;
			margin-bottom: 8px;
			font-size: 12px;
			color: rgba(255, 255, 255, 0.9);
		}

		.control-panel .hint {
			margin-top: 8px;
			font-size: 11px;
			color: rgba(255, 255, 255, 0.6);
			line-height: 1.4;
		}

		.stream-select {
			padding: 7px 10px;
			border: 1px solid rgba(255, 255, 255, 0.3);
			border-radius: 6px;
			background: rgba(255, 255, 255, 0.1);
			color: white;
			font-size: 12px;
			cursor: pointer;
		}

		.stream-select option {
			background: #2c3e50;
			color: white;
		}

		/* å“åº”å¼è®¾è®¡ */
		@media (max-width: 1200px) {
			.header {
				height: 100px;
			}

			.header-left,
			.header-right {
				gap: 10px;
			}

			.header-label {
				font-size: 28px;
				padding: 5px 16px;
			}

			.header-vote-value {
				font-size: 40px;
			}

			.header-vote-percentage {
				font-size: 22px;
			}

			.timer-section {
				padding: 28px 28px;
				gap: 18px;
			}

			.segment-info {
				font-size: 36px;
			}

			.timer-display {
				font-size: 130px;
				letter-spacing: 10px;
			}

			.timer-btn {
				padding: 10px 22px;
				font-size: 13px;
			}

			.timer-wrapper {
				flex-direction: column;
				gap: 24px;
			}

			.timer-actions {
				align-items: center;
			}

			.timer-controls,
			.segment-controls {
				justify-content: center;
			}

			.judges-list {
				gap: 20px;
			}

			.main-content {
				padding: 0 24px;
			}

			.judges-section {
				padding: 10px 24px 26px;
			}
		}

		@media (max-width: 768px) {
			.container {
				padding-top: 16px;
				gap: 16px;
			}

			.header {
				height: 90px;
			}

			.header-left,
			.header-right {
				gap: 8px;
			}

			.header-label {
				font-size: 24px;
				padding: 4px 12px;
			}

			.header-vote-value {
				font-size: 32px;
			}

			.header-vote-percentage {
				font-size: 20px;
			}

			.timer-section {
				padding: 16px;
				gap: 12px;
			}

			.segment-info {
				font-size: 30px;
			}

			.timer-display {
				font-size: 110px;
				letter-spacing: 8px;
			}

			.timer-controls,
			.segment-controls {
				flex-wrap: wrap;
				justify-content: center;
			}

			.timer-btn {
				padding: 8px 16px;
				font-size: 12px;
			}

			.timer-wrapper {
				gap: 20px;
			}

			.timer-actions {
				width: 100%;
				align-items: center;
			}

			.judges-section {
				padding: 12px 18px 24px;
				gap: 20px;
			}

			.main-content {
				padding: 0 18px;
			}

			.judges-list {
				flex-direction: column;
				align-items: stretch;
			}

			.judge-card {
				padding: 18px 20px;
			}

			.judge-avatar {
				width: 72px;
				height: 72px;
			}

			.judge-name {
				font-size: 18px;
			}

			.judge-votes .value {
				font-size: 28px;
			}
		}

		.chart-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(10px); }
		.chart-container { width: 90%; max-width: 1600px; height: 85%; background: rgba(26,35,38,0.95); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.15); position: relative; }
		.chart-title { font-size: 28px; font-weight: 900; color: white; letter-spacing: 2px; margin-bottom: 20px; }
		#vote-trend-chart { width: 100%; height: calc(100% - 60px); }
		.show-chart-btn { position: fixed; bottom: 80px; left: 20px; padding: 12px 24px; font-size: 15px; font-weight: 600; border: 2px solid rgba(52,152,219,0.5); border-radius: 8px; background: rgba(52,152,219,0.15); color: #3498db; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(8px); z-index: 1000; display: none; }
		.show-chart-btn.visible { display: flex; align-items: center; gap: 8px; }
	</style>
</head>
<body>
	<div class="container">
		<!-- é¡¶éƒ¨æ¡çŠ¶æ˜¾ç¤º -->
		<div class="header" id="header-bar">
			<!-- æ­£æ–¹åŒºåŸŸï¼ˆå·¦ä¾§çº¢è‰²ï¼‰ -->
			<div class="header-left" id="header-left" style="width: 50%;">
				<div class="header-label" id="header-left-label">æ­£æ–¹</div>
				<div class="header-center-content">
					<div class="header-vote-percentage" id="header-left-percentage">50%</div>
					<div class="header-vote-value" id="header-left-votes">0</div>
				</div>
			</div>

			<!-- åˆ†éš”çº¿ -->
			<div class="header-divider"></div>

			<!-- åæ–¹åŒºåŸŸï¼ˆå³ä¾§è“è‰²ï¼‰ -->
			<div class="header-right" id="header-right" style="width: 50%;">
				<div class="header-center-content">
					<div class="header-vote-value" id="header-right-votes">0</div>
					<div class="header-vote-percentage" id="header-right-percentage">50%</div>
				</div>
				<div class="header-label" id="header-right-label">åæ–¹</div>
			</div>

			<!-- æµä¿¡æ¯ï¼ˆå³ä¸‹è§’ï¼‰ -->
			<div class="stream-info" id="stream-info-box" onclick="toggleStreamInfo(event)">
				<span class="status-indicator" id="status-indicator"></span>
				<span id="stream-name">åŠ è½½ä¸­...</span>
			</div>
		</div>

		<!-- è®¡æ—¶å™¨å’Œç¯èŠ‚æ§åˆ¶åŒºåŸŸ -->
		<div class="timer-section" id="timer-section">
			<div class="timer-wrapper">
				<div class="timer-info">
					<div class="segment-info" id="segment-info">å‡†å¤‡å¼€å§‹</div>
					<div class="timer-display" id="timer-display">00:00</div>
				</div>
				<div class="timer-actions" style="display: none;">
					<div class="timer-controls">
						<button class="timer-btn" id="btn-pause" onclick="toggleTimer()">æš‚åœ</button>
						<button class="timer-btn primary" id="btn-resume" onclick="resumeTimer()" style="display: none;">æ¢å¤</button>
						<button class="timer-btn danger" onclick="resetTimer()">é‡ç½®</button>
					</div>
					<div class="segment-controls">
						<button class="timer-btn" onclick="previousSegment()" id="btn-prev">ä¸Šä¸€ä¸ªç¯èŠ‚ (â†)</button>
						<button class="timer-btn primary" onclick="nextSegment()" id="btn-next">ä¸‹ä¸€ä¸ªç¯èŠ‚ (â†’)</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ä¸»å†…å®¹åŒº -->
		<div class="main-content" id="main-content" style="display: none;">
			<div id="error" class="error" style="display: none;"></div>

			<div id="votes-display" class="votes-display" style="display: none;">
			</div>
		</div>

		<!-- AIå†…å®¹å±•ç¤ºï¼ˆAIå¯åŠ¨åæ˜¾ç¤ºäº‹å…ˆå‡†å¤‡çš„æ–‡æ¡ˆï¼‰ -->
		<div class="ai-content-section" id="ai-content-section" style="display: none; padding: 20px; margin: 20px; background: rgba(0,0,0,0.3); border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);">
			<div class="ai-content-title" style="font-size: 20px; font-weight: 700; margin-bottom: 15px; color: #3498db;">AI è¯†åˆ«å†…å®¹</div>
			<div id="ai-content-list" style="max-height: 300px; overflow-y: auto;">
				<!-- ç”±è„šæœ¬æ¸²æŸ“ -->
			</div>
		</div>

		<!-- è¯„å§”ç¥¨æ•°å±•ç¤º -->
		<div class="judges-section" id="judges-section">
			<div class="judges-title">è¯„å§”ç¥¨æ•°</div>
			<div class="judges-list" id="judges-list">
				<!-- ç”±è„šæœ¬æ¸²æŸ“ -->
			</div>
		</div>

		<!-- ç”¨æˆ·è¯„è®ºï¼ˆå¤§å±å±•ç¤ºï¼‰ -->
		<div class="comments-section" id="comments-section" style="display: none; padding: 16px 20px; margin: 16px 20px; background: rgba(0,0,0,0.25); border-radius: 12px; border: 1px solid rgba(255,255,255,0.15); max-height: 180px; overflow-y: auto;">
			<div class="comments-title" style="font-size: 18px; font-weight: 700; margin-bottom: 12px; color: rgba(255,255,255,0.95);">ç”¨æˆ·è¯„è®º</div>
			<div id="comments-list-bigscreen" style="display: flex; flex-direction: column; gap: 8px;">
				<!-- ç”±è„šæœ¬æˆ–æ¥å£å¡«å…… -->
			</div>
		</div>

		<!-- æ§åˆ¶é¢æ¿ï¼ˆæŒ‰F12æˆ–ç‚¹å‡»æµä¿¡æ¯æ˜¾ç¤ºï¼‰ -->
		<div class="control-panel" id="control-panel">
			<label>é€‰æ‹©ç›´æ’­æµï¼š</label>
			<select id="stream-select" class="stream-select">
				<option value="">åŠ è½½ä¸­...</option>
			</select>
			<div class="hint">
				æç¤ºï¼š<br>
				â€¢ æŒ‰ F12 æˆ–ç‚¹å‡»å³ä¸‹è§’æµä¿¡æ¯å¯æ˜¾ç¤º/éšè—æ­¤é¢æ¿<br>
				â€¢ å¯é€šè¿‡URLå‚æ•°æŒ‡å®šæµï¼š?stream_id=xxx
			</div>
		</div>
	</div>

	<div class="chart-overlay" id="chart-overlay" onclick="hideVoteTrendChart()">
		<div class="chart-container" onclick="event.stopPropagation()">
			<div class="chart-title">åŒæ–¹ç¥¨æ•°å˜åŒ–è¶‹åŠ¿</div>
			<div id="vote-trend-chart"></div>
		</div>
	</div>

	<button class="show-chart-btn" id="show-chart-btn">æŸ¥çœ‹ç¥¨æ•°è¶‹åŠ¿</button>

	<script>
		// æœåŠ¡å™¨é…ç½®ï¼ˆä»admin.jsç»§æ‰¿æˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼‰
		const getAPIBase = () => {
			if (window.SERVER_CONFIG && window.SERVER_CONFIG.BASE_URL) {
				return window.SERVER_CONFIG.BASE_URL;
			}
			if (typeof window !== 'undefined' && window.location && window.location.origin) return window.location.origin;
			return 'http://localhost:8080';
		};

		// æ˜¯å¦ä»…æŸ¥çœ‹æ¨¡å¼ï¼ˆè¯¦æƒ…æ‰“å¼€ï¼šä¸è‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶ï¼Œåªå±•ç¤ºå½“å‰ç¥¨æ¯”ä¸å‰©ä½™æ—¶é—´ï¼‰
		const isViewOnly = /[?&]view_only=1(?=&|$)/.test(window.location.search);
		// å…¨å±€çŠ¶æ€
		let currentStreamId = null;
		let refreshTimer = null;
		let ws = null;
		const voteHistory = [];
		let lastVoteForTrend = { time: 0, leftVotes: 0, rightVotes: 0 };
		let voteTrendIntervalId = null;
		const VOTE_TREND_MAX_POINTS = 4;
		const VOTE_TREND_Y_MAX = 15;
		const VOTE_TREND_INTERVAL_MS = 30000;
		let voteTrendChart = null;
		let debateStartTime = null;
		let chartShown = false;

		// è¾©è®ºæµç¨‹é…ç½®ï¼ˆå¯åŠ¨æ€æ›´æ–°ï¼‰
		let DEBATE_SEGMENTS = [
			{ name: 'æ­£æ–¹å‘è¨€', duration: 180, side: 'left' },      // 3åˆ†é’Ÿ
			{ name: 'åæ–¹è´¨é—®', duration: 120, side: 'right' },     // 2åˆ†é’Ÿ
			{ name: 'åæ–¹å‘è¨€', duration: 180, side: 'right' },      // 3åˆ†é’Ÿ
			{ name: 'æ­£æ–¹è´¨é—®', duration: 120, side: 'left' },       // 2åˆ†é’Ÿ
			{ name: 'è‡ªç”±è¾©è®º', duration: 300, side: 'both' },      // 5åˆ†é’Ÿ
			{ name: 'æ­£æ–¹æ€»ç»“', duration: 120, side: 'left' },      // 2åˆ†é’Ÿ
			{ name: 'åæ–¹æ€»ç»“', duration: 120, side: 'right' }      // 2åˆ†é’Ÿ
		];

		// è®¡æ—¶å™¨çŠ¶æ€
		let timerState = {
			currentSegmentIndex: -1,  // -1è¡¨ç¤ºæœªå¼€å§‹
			remainingSeconds: 0,
			isRunning: false,
			isPaused: false,
			timerInterval: null
		};

		// è¯„å§”é»˜è®¤æ•°æ®ï¼ˆä»åå° API åŠ è½½ï¼‰
		const DEFAULT_JUDGES = [
			{ id: 'judge-1', name: 'è¯„å§”1', role: 'ä¸»è¯„å§”', avatar: '/admin/assets/images/judges/osmanthus.jpg', votes: 0 },
			{ id: 'judge-2', name: 'è¯„å§”2', role: 'å˜‰å®¾è¯„å§”', avatar: '/admin/assets/images/judges/osmanthus.jpg', votes: 0 },
			{ id: 'judge-3', name: 'è¯„å§”3', role: 'å˜‰å®¾è¯„å§”', avatar: '/admin/assets/images/judges/osmanthus.jpg', votes: 0 }
		];

		let judgeState = [...DEFAULT_JUDGES];

		// ç”¨äºæ£€æµ‹ã€Œä»æœªç›´æ’­â†’ç›´æ’­ã€ä»¥è‡ªåŠ¨å¼€å§‹ 60 ç§’å€’è®¡æ—¶
		let lastWasLive = false;

		// åˆ‡æ¢æµä¿¡æ¯æ˜¾ç¤º/éšè—
		function toggleStreamInfo(event) {
			event.stopPropagation();
			const box = document.getElementById('stream-info-box');
			if (box.classList.contains('collapsed')) {
				box.classList.remove('collapsed');
			} else {
				box.classList.add('collapsed');
			}
		}

		// ä»URLå‚æ•°è·å–stream_id
		function getStreamIdFromURL() {
			const params = new URLSearchParams(window.location.search);
			return params.get('stream_id') || params.get('streamId');
		}

		// åˆå§‹åŒ–
		document.addEventListener('DOMContentLoaded', async () => {
			// æ˜¾ç¤ºæ§åˆ¶é¢æ¿ï¼ˆæŒ‰F12æˆ–ç‚¹å‡»å³ä¸Šè§’ï¼‰
			document.addEventListener('keydown', (e) => {
				if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
					e.preventDefault();
					const panel = document.getElementById('control-panel');
					panel.classList.toggle('show');
				}
				// é”®ç›˜å¿«æ·é”®
				if (e.key === 'ArrowLeft' && !e.ctrlKey && !e.shiftKey) {
					e.preventDefault();
					previousSegment();
				}
				if (e.key === 'ArrowRight' && !e.ctrlKey && !e.shiftKey) {
					e.preventDefault();
					nextSegment();
				}
				if (e.key === ' ' && !e.ctrlKey && !e.shiftKey) {
					e.preventDefault();
					resumeTimer();
				}
				if (e.key === 'p' || e.key === 'P') {
					if (!e.ctrlKey && !e.shiftKey) {
						e.preventDefault();
						toggleTimer();
					}
				}
			});

			// ç‚¹å‡»å³ä¸Šè§’æµä¿¡æ¯ä¹Ÿå¯ä»¥æ˜¾ç¤ºæ§åˆ¶é¢æ¿
			document.getElementById('stream-name').addEventListener('click', () => {
				const panel = document.getElementById('control-panel');
				panel.classList.toggle('show');
			});

			// åˆå§‹åŒ–è®¡æ—¶å™¨æ˜¾ç¤º
			updateTimerDisplay();
			updateSegmentInfo();

			// å¤§å±ç¥¨æ¯”å…ˆåˆå§‹åŒ–ä¸º 0ï¼ˆ50%/50%ï¼‰ï¼Œé¿å…å…ˆæŒ¤åˆ°å·¦è¾¹å†å±•å¼€æ—¶å¸¦å‡ºä¸Šä¸€è½®æ•°æ®
			updateVotesDisplay(0, 0, 0, 50, 50);

			// æ¸²æŸ“è¯„å§”ä¿¡æ¯
			renderJudges(judgeState);

			// åŠ è½½ç›´æ’­æµåˆ—è¡¨
			await loadStreamsList();

			// åˆå§‹åŒ–WebSocket
			initWebSocket();

			// å¼€å§‹å®šæ—¶åˆ·æ–°
			startAutoRefresh();
			const chartBtn = document.getElementById('show-chart-btn');
			if (chartBtn) { chartBtn.addEventListener('click', () => { showVoteTrendChart(); }); }
		});

		// æ¸²æŸ“è¯„å§”åŒºåŸŸï¼ˆæ˜¾ç¤ºè¯„å§”æŠ•ç»™è°äº†ï¼šæ­£æ–¹/åæ–¹ + ç¥¨æ•°ï¼‰
		function renderJudges(judges) {
			const listEl = document.getElementById('judges-list');
			if (!listEl) return;

			listEl.innerHTML = '';

			judges.forEach((judge) => {
				const card = document.createElement('div');
				card.className = 'judge-card';
				card.setAttribute('data-judge-id', judge.id);

				const avatar = document.createElement('div');
				avatar.className = 'judge-avatar';
				if (judge.avatar) {
					const img = document.createElement('img');
					const base = window.location.origin || '';
					img.src = (judge.avatar.startsWith('http') || judge.avatar.startsWith('data:')) ? judge.avatar : (base + (judge.avatar.startsWith('/') ? '' : '/') + judge.avatar);
					img.alt = judge.name || 'å¤´åƒ';
					img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:50%;';
					img.onerror = function() { this.src = base + '/static/iconfont/wode.png'; this.onerror = null; };
					avatar.appendChild(img);
				} else {
					avatar.style.backgroundImage = `linear-gradient(135deg, #666, #444)`;
				}

				const info = document.createElement('div');
				info.className = 'judge-info';

				const nameEl = document.createElement('div');
				nameEl.className = 'judge-name';
				nameEl.textContent = judge.name;

				const roleEl = document.createElement('div');
				roleEl.className = 'judge-role';
				roleEl.textContent = judge.role || '';

				const votesWrap = document.createElement('div');
				votesWrap.className = 'judge-votes';

				const label = document.createElement('span');
				label.className = 'label';
				label.textContent = 'ç¥¨æ•°';

				const value = document.createElement('span');
				value.className = 'value';
				value.id = `${judge.id}-votes`;
				// è¯„å§”æŠ•ç»™è°äº†ï¼šæ˜¾ç¤ºã€Œæ­£æ–¹ 10ç¥¨ã€æˆ–ã€Œåæ–¹ 10ç¥¨ã€ï¼ŒæœªæŠ•ç¥¨æ—¶æ˜¾ç¤º 0
				const votedVotes = judge.votedVotes ?? judge.votes ?? 0;
				const votedSide = judge.votedSide;
				if (votedSide === 'left' && votedVotes > 0) {
					value.textContent = 'æ­£æ–¹ ' + votedVotes + 'ç¥¨';
					value.style.color = '#e74c3c'; // æ­£æ–¹=çº¢è‰²ï¼Œä¸é¡¶éƒ¨æ¡ä¸€è‡´
				} else if (votedSide === 'right' && votedVotes > 0) {
					value.textContent = 'åæ–¹ ' + votedVotes + 'ç¥¨';
					value.style.color = '#3498db'; // åæ–¹=è“è‰²ï¼Œä¸é¡¶éƒ¨æ¡ä¸€è‡´
				} else {
					value.textContent = votedVotes;
					value.style.color = '';
				}

				votesWrap.appendChild(label);
				votesWrap.appendChild(value);

				info.appendChild(nameEl);
				if (judge.role) {
					info.appendChild(roleEl);
				}
				info.appendChild(votesWrap);

				card.appendChild(avatar);
				card.appendChild(info);

				listEl.appendChild(card);
			});
		}

		// æ›´æ–°å•ä¸ªè¯„å§”ç¥¨æ•°
		function updateJudgeVotes(judgeId, votes) {
			const judge = judgeState.find(item => item.id === judgeId);
			if (!judge) return;
			judge.votes = Math.max(0, Number(votes) || 0);

			const valueEl = document.getElementById(`${judgeId}-votes`);
			if (valueEl) {
				valueEl.textContent = judge.votes;
				valueEl.classList.add('updated');
				setTimeout(() => valueEl.classList.remove('updated'), 600);
			}
		}

		// æ‰¹é‡æ›´æ–°è¯„å§”ä¿¡æ¯
		function setJudges(data = []) {
			if (!Array.isArray(data) || data.length === 0) return;
			judgeState = data.map((item, idx) => ({
				...DEFAULT_JUDGES[idx],
				...item
			}));
			renderJudges(judgeState);
		}

		// æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤ºï¼ˆMM:SSï¼‰
		function formatTime(seconds) {
			const mins = Math.floor(seconds / 60);
			const secs = seconds % 60;
			return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
		}

		// æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
		function updateTimerDisplay() {
			const timerEl = document.getElementById('timer-display');
			timerEl.textContent = formatTime(timerState.remainingSeconds);

			// å‰©ä½™æ—¶é—´å°‘äº30ç§’æ—¶æ˜¾ç¤ºè­¦å‘Š
			if (timerState.remainingSeconds <= 30 && timerState.remainingSeconds > 0) {
				timerEl.classList.add('warning');
			} else {
				timerEl.classList.remove('warning');
			}
		}

		// æ›´æ–°ç¯èŠ‚ä¿¡æ¯æ˜¾ç¤º
		function updateSegmentInfo() {
			const segmentInfoEl = document.getElementById('segment-info');
			const btnPrev = document.getElementById('btn-prev');
			const btnNext = document.getElementById('btn-next');

			if (timerState.currentSegmentIndex === -1) {
				segmentInfoEl.textContent = 'å‡†å¤‡å¼€å§‹';
				btnPrev.disabled = true;
				btnNext.disabled = false;
			} else if (timerState.currentSegmentIndex >= DEBATE_SEGMENTS.length) {
				segmentInfoEl.textContent = 'è¾©è®ºç»“æŸ';
				btnPrev.disabled = false;
				btnNext.disabled = true;
				const chartBtn = document.getElementById('show-chart-btn');
				if (chartBtn) { chartBtn.classList.add('visible'); }
			} else {
				const segment = DEBATE_SEGMENTS[timerState.currentSegmentIndex];
				segmentInfoEl.textContent = segment.name;
				btnPrev.disabled = false;
				btnNext.disabled = false;
			}
		}

		// å‡†å¤‡å¼€å§‹çŠ¶æ€ä¸‹çš„ 60 ç§’å€’è®¡æ—¶ï¼ˆç›´æ’­å¼€å§‹æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œä¸ç›´æ’­å…³é—­æ—¶é—´åŒæ­¥ï¼‰
		function startPreStartCountdown() {
			if (timerState.currentSegmentIndex !== -1) return;
			stopTimer();
			timerState.remainingSeconds = 60;
			timerState.isPaused = false;
			updateTimerDisplay();
			updateSegmentInfo();
			startTimer();
		}

		// å¼€å§‹è®¡æ—¶å™¨
		function startTimer() {
			if (timerState.timerInterval) {
				clearInterval(timerState.timerInterval);
			}

			timerState.isRunning = true;
			timerState.isPaused = false;

			timerState.timerInterval = setInterval(() => {
				if (timerState.remainingSeconds > 0) {
					timerState.remainingSeconds--;
					updateTimerDisplay();

					// æ—¶é—´åˆ°
					if (timerState.remainingSeconds === 0) {
						stopTimer();
						updateSegmentInfo();
						console.log('æ—¶é—´åˆ°ï¼');
					}
				} else {
					stopTimer();
				}
			}, 1000);

			updateButtonStates();
		}

		// åœæ­¢è®¡æ—¶å™¨
		function stopTimer() {
			if (timerState.timerInterval) {
				clearInterval(timerState.timerInterval);
				timerState.timerInterval = null;
			}
			timerState.isRunning = false;
			updateButtonStates();
		}

		// æš‚åœ/æ¢å¤è®¡æ—¶å™¨
		function toggleTimer() {
			if (timerState.isRunning) {
				stopTimer();
				timerState.isPaused = true;
			} else if (timerState.isPaused && timerState.remainingSeconds > 0) {
				startTimer();
			}
			updateButtonStates();
		}

		// æ¢å¤è®¡æ—¶å™¨
		function resumeTimer() {
			if (timerState.isPaused && timerState.remainingSeconds > 0) {
				startTimer();
			} else if (timerState.currentSegmentIndex >= 0 && timerState.remainingSeconds > 0) {
				startTimer();
			}
			updateButtonStates();
		}

		// é‡ç½®è®¡æ—¶å™¨
		function resetTimer() {
			stopTimer();
			if (timerState.currentSegmentIndex >= 0 && timerState.currentSegmentIndex < DEBATE_SEGMENTS.length) {
				const segment = DEBATE_SEGMENTS[timerState.currentSegmentIndex];
				timerState.remainingSeconds = segment.duration;
				timerState.isPaused = false;
				updateTimerDisplay();
				updateButtonStates();
			}
		}

		// æ›´æ–°æŒ‰é’®çŠ¶æ€
		function updateButtonStates() {
			const btnPause = document.getElementById('btn-pause');
			const btnResume = document.getElementById('btn-resume');

			if (timerState.isRunning) {
				btnPause.style.display = 'inline-block';
				btnResume.style.display = 'none';
			} else if (timerState.isPaused || (timerState.currentSegmentIndex >= 0 && timerState.remainingSeconds > 0)) {
				btnPause.style.display = 'none';
				btnResume.style.display = 'inline-block';
			} else {
				btnPause.style.display = 'inline-block';
				btnResume.style.display = 'none';
			}
		}

		// åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç¯èŠ‚
		function nextSegment() {
			stopTimer();

			if (timerState.currentSegmentIndex < DEBATE_SEGMENTS.length - 1) {
				timerState.currentSegmentIndex++;
				const segment = DEBATE_SEGMENTS[timerState.currentSegmentIndex];
				timerState.remainingSeconds = segment.duration;
				timerState.isPaused = false;

				updateTimerDisplay();
				updateSegmentInfo();
				updateButtonStates();
			} else if (timerState.currentSegmentIndex === DEBATE_SEGMENTS.length - 1) {
				timerState.currentSegmentIndex = DEBATE_SEGMENTS.length;
				timerState.remainingSeconds = 0;
				updateTimerDisplay();
				updateSegmentInfo();
				updateButtonStates();
			} else if (timerState.currentSegmentIndex === -1) {
				timerState.currentSegmentIndex = 0;
				const segment = DEBATE_SEGMENTS[0];
				timerState.remainingSeconds = segment.duration;
				timerState.isPaused = false;

				updateTimerDisplay();
				updateSegmentInfo();
				updateButtonStates();
			}
		}

		// åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªç¯èŠ‚
		function previousSegment() {
			stopTimer();

			if (timerState.currentSegmentIndex > 0) {
				timerState.currentSegmentIndex--;
				const segment = DEBATE_SEGMENTS[timerState.currentSegmentIndex];
				timerState.remainingSeconds = segment.duration;
				timerState.isPaused = false;

				updateTimerDisplay();
				updateSegmentInfo();
				updateButtonStates();
			} else if (timerState.currentSegmentIndex === 0) {
				timerState.currentSegmentIndex = -1;
				timerState.remainingSeconds = 0;
				updateTimerDisplay();
				updateSegmentInfo();
				updateButtonStates();
			}
		}

		// åŠ è½½ç›´æ’­æµåˆ—è¡¨
		async function loadStreamsList() {
			try {
				const response = await fetch(`${getAPIBase()}/api/v1/admin/streams`);
				const result = await response.json();

				const streams = result?.data?.streams || result?.streams || (Array.isArray(result) ? result : []);
				const select = document.getElementById('stream-select');

				select.innerHTML = '<option value="">è¯·é€‰æ‹©ç›´æ’­æµ</option>';

				if (streams.length === 0) {
					select.innerHTML += '<option value="" disabled>æš‚æ— å¯ç”¨çš„ç›´æ’­æµ</option>';
					return;
				}

				streams.forEach(stream => {
					if (stream.enabled) {
						const option = document.createElement('option');
						option.value = stream.id;
						option.textContent = `${stream.name} (${stream.type?.toUpperCase() || 'HLS'})`;
						select.appendChild(option);
					}
				});

				const urlStreamId = getStreamIdFromURL();
				let selectedStreamId = null;

				if (urlStreamId) {
					const urlStream = streams.find(s => s.id === urlStreamId && s.enabled);
					if (urlStream) {
						selectedStreamId = urlStreamId;
						select.value = urlStreamId;
					}
				}

				if (!selectedStreamId) {
					const firstEnabled = streams.find(s => s.enabled);
					if (firstEnabled) {
						selectedStreamId = firstEnabled.id;
						select.value = firstEnabled.id;
					}
				}

				if (selectedStreamId) {
					currentStreamId = selectedStreamId;
					await loadVotes(selectedStreamId);
				}

				select.addEventListener('change', async (e) => {
					const streamId = e.target.value;
					if (streamId) {
						currentStreamId = streamId;
						const url = new URL(window.location);
						url.searchParams.set('stream_id', streamId);
						window.history.pushState({}, '', url);
						await loadVotes(streamId);
					}
				});
			} catch (error) {
				console.error('åŠ è½½ç›´æ’­æµåˆ—è¡¨å¤±è´¥:', error);
			}
		}

		// åŠ è½½ç¥¨æ•°æ•°æ®ï¼ˆçŠ¶æ€/è¯„å§”ç­‰ç”¨ dashboardï¼›ç¥¨æ¯”åªç”¨å¤§å±ä¸“ç”¨æ¥å£ï¼Œä¸ç¥¨æ•°ç®¡ç†å®Œå…¨éš”ç¦»ï¼‰
		async function loadVotes(streamId, showLoadingState = true) {
			if (!streamId) {
				return;
			}

			try {
				const base = getAPIBase();
				const [dashboardRes, ratioRes] = await Promise.all([
					fetch(`${base}/api/v1/admin/dashboard?stream_id=${streamId}`),
					fetch(`${base}/api/v1/display/vote-ratio?stream_id=${streamId}`)
				]);
				const dashboardResult = await dashboardRes.json();
				const data = dashboardResult?.data || dashboardResult;

				if (!data) {
					throw new Error('æ— æ³•è·å–ç¥¨æ•°æ•°æ®');
				}

				const streamSelect = document.getElementById('stream-select');
				const selectedOption = streamSelect?.options[streamSelect.selectedIndex];
				const streamName = selectedOption ? selectedOption.textContent : 'æœªçŸ¥æµ';
				document.getElementById('stream-name').textContent = streamName;

				const statusIndicator = document.getElementById('status-indicator');
				if (data.isLive) {
					statusIndicator.classList.add('live');
					// éã€Œä»…æŸ¥çœ‹ã€æ—¶ï¼šç›´æ’­å¼€å§‹æ—¶è‡ªåŠ¨å¼€å§‹ 60 ç§’å€’è®¡æ—¶ï¼ˆä»…å½“å¤„äºã€Œå‡†å¤‡å¼€å§‹ã€ä¸”å½“å‰æœªåœ¨å€’è®¡æ—¶ï¼‰
					if (!isViewOnly && !lastWasLive && timerState.currentSegmentIndex === -1 && !timerState.isRunning) {
						startPreStartCountdown();
					}
				} else {
					statusIndicator.classList.remove('live');
				}
				lastWasLive = !!data.isLive;

				// ç¥¨æ¯”ï¼šä¼˜å…ˆç”¨ vote-ratio æ¥å£ï¼ˆå½“å‰ç¥¨æ•°ï¼‰ï¼Œå¤±è´¥åˆ™ç”¨ dashboard çš„å½“å‰ç¥¨æ•°
				let leftVotes = 0, rightVotes = 0, totalVotes = 0, leftPercentage = 50, rightPercentage = 50;
				try {
					const ratioResult = await ratioRes.json();
					const ratio = ratioResult?.data || ratioResult;
					if (ratioResult?.success !== false && ratio) {
						leftVotes = ratio.leftVotes ?? 0;
						rightVotes = ratio.rightVotes ?? 0;
						totalVotes = ratio.totalVotes ?? (leftVotes + rightVotes);
						leftPercentage = ratio.leftPercentage ?? (totalVotes > 0 ? Math.round((leftVotes / totalVotes) * 100) : 50);
						rightPercentage = ratio.rightPercentage ?? (totalVotes > 0 ? Math.round((rightVotes / totalVotes) * 100) : 50);
					} else {
						throw new Error('ratio æ— æ•°æ®');
					}
				} catch (e) {
					// æ¥å›å½“å‰ç¥¨æ•°ï¼šæ¥å£å¤±è´¥æ—¶ç”¨ dashboard çš„ leftVotes/rightVotesï¼ˆæˆ– currentLeftVotes/currentRightVotesï¼‰
					const curLeft = data.currentLeftVotes != null ? data.currentLeftVotes : (data.leftVotes ?? 0);
					const curRight = data.currentRightVotes != null ? data.currentRightVotes : (data.rightVotes ?? 0);
					leftVotes = curLeft;
					rightVotes = curRight;
					totalVotes = data.totalVotes ?? (leftVotes + rightVotes);
					leftPercentage = totalVotes > 0 ? Math.round((leftVotes / totalVotes) * 100) : 50;
					rightPercentage = totalVotes > 0 ? Math.round((rightVotes / totalVotes) * 100) : 50;
					console.warn('å¤§å±ç¥¨æ¯”æ¥å£å¤±è´¥ï¼Œä½¿ç”¨ dashboard å½“å‰ç¥¨æ•°', e);
				}
				updateVotesDisplay(leftVotes, rightVotes, totalVotes, leftPercentage, rightPercentage);

				// AIå¯åŠ¨æ—¶åŠ è½½å¹¶å±•ç¤ºAIå†…å®¹
				if (data.aiStatus === 'running') {
					document.getElementById('ai-content-section').style.display = 'block';
					await loadAIContentForDisplay(streamId);
				} else {
					document.getElementById('ai-content-section').style.display = 'none';
				}
				
				// åŠ è½½è¯¥æµçš„è¾©è®ºæµç¨‹é…ç½®
				await loadDebateFlowConfig(streamId);
				// åŠ è½½è¯¥æµçš„è¯„å§”é…ç½®
				await loadJudgesConfig(streamId);
				// ç›´æ’­ç»“æŸåç»´æŒæœ€åæ¯”åˆ†ï¼›è¯„å§”æŠ•ç¥¨ä»æ¥å£/WebSocket æ›´æ–°ååœ¨æ­¤å±•ç¤º
				if (data.judgeVotes && Array.isArray(data.judgeVotes) && data.judgeVotes.length > 0) {
					data.judgeVotes.forEach(jv => {
						const judge = judgeState.find(j => j.id === jv.judgeId);
						if (judge) {
							judge.votedSide = jv.votedSide;
							judge.votedVotes = jv.votes;
						}
					});
					renderJudges(judgeState);
				}
			} catch (error) {
				console.error('åŠ è½½ç¥¨æ•°å¤±è´¥:', error);
			}
		}
		
		/**
		 * åŠ è½½AIå†…å®¹å¹¶å±•ç¤ºï¼ˆAIå¯åŠ¨åæ˜¾ç¤ºäº‹å…ˆå‡†å¤‡çš„æ–‡æ¡ˆï¼‰
		 */
		async function loadAIContentForDisplay(streamId) {
			try {
				const url = streamId 
					? `${getAPIBase()}/api/ai-content?stream_id=${streamId}` 
					: `${getAPIBase()}/api/ai-content`;
				const response = await fetch(url);
				const result = await response.json();
				const list = result?.data || result || [];
				const container = document.getElementById('ai-content-list');
				if (!container) return;
				if (!Array.isArray(list) || list.length === 0) {
					container.innerHTML = '<div style="color: rgba(255,255,255,0.6); padding: 20px; text-align: center;">æš‚æ— AIå†…å®¹ã€‚<br>è¯·ç¡®è®¤å¤§å±é€‰æ‹©çš„è¾©é¢˜ä¸åå°ã€ŒAI å†…å®¹ç®¡ç†ã€ä¸­ä¸€è‡´ï¼Œå¹¶åœ¨åå°ç‚¹å‡»ã€Œå¯åŠ¨AIè¯†åˆ«ã€ç”Ÿæˆã€‚</div>';
					return;
				}
				container.innerHTML = list.slice(0, 10).map(item => {
					const side = item.side === 'left' ? 'æ­£æ–¹' : 'åæ–¹';
					const sideColor = item.side === 'left' ? '#e74c3c' : '#3498db';
					return `<div style="padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; border-left: 4px solid ${sideColor};">
						<span style="color: ${sideColor}; font-weight: 600; font-size: 12px;">${side}</span>
						<div style="color: rgba(255,255,255,0.9); margin-top: 6px; font-size: 14px;">${(item.text || '').substring(0, 80)}${(item.text || '').length > 80 ? '...' : ''}</div>
					</div>`;
				}).join('');
			} catch (e) {
				console.warn('åŠ è½½AIå†…å®¹å¤±è´¥:', e);
				const container = document.getElementById('ai-content-list');
				if (container) container.innerHTML = '<div style="color: rgba(255,255,255,0.5); padding: 20px; text-align: center;">åŠ è½½å¤±è´¥</div>';
			}
		}

		/**
		 * ä»APIåŠ è½½è¾©è®ºæµç¨‹é…ç½®
		 */
		async function loadDebateFlowConfig(streamId) {
			try {
				const response = await fetch(`${getAPIBase()}/api/admin/debate-flow?stream_id=${streamId}`);
				const result = await response.json();
				
				if (result && result.segments && Array.isArray(result.segments) && result.segments.length > 0) {
					// æ›´æ–°å…¨å±€ DEBATE_SEGMENTS
					DEBATE_SEGMENTS = result.segments;
					console.log('âœ… å·²åŠ è½½è‡ªå®šä¹‰è¾©è®ºæµç¨‹é…ç½®:', DEBATE_SEGMENTS);
				} else {
					console.warn('âš ï¸ ä½¿ç”¨é»˜è®¤è¾©è®ºæµç¨‹é…ç½®');
				}
			} catch (error) {
				console.warn('âš ï¸ åŠ è½½è¾©è®ºæµç¨‹é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error);
			}
		}

		/**
		 * ä»APIåŠ è½½è¯„å§”é…ç½®
		 */
		async function loadJudgesConfig(streamId) {
			try {
				const response = await fetch(`${getAPIBase()}/api/admin/judges?stream_id=${encodeURIComponent(streamId)}`);
				const result = await response.json();
				if (result.success && result.data && Array.isArray(result.data.judges) && result.data.judges.length > 0) {
					judgeState = result.data.judges.map((j, idx) => ({
						...DEFAULT_JUDGES[idx],
						...j
					}));
					renderJudges(judgeState);
				}
			} catch (error) {
				console.warn('âš ï¸ åŠ è½½è¯„å§”é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error);
			}
		}

		// æ›´æ–°ç¥¨æ•°æ˜¾ç¤º
		function updateVotesDisplay(leftVotes, rightVotes, totalVotes, leftPercentage, rightPercentage) {
			const leftEl = document.getElementById('header-left-votes');
			const rightEl = document.getElementById('header-right-votes');
			const leftPctEl = document.getElementById('header-left-percentage');
			const rightPctEl = document.getElementById('header-right-percentage');
			const leftBar = document.getElementById('header-left');
			const rightBar = document.getElementById('header-right');

			const currentLeft = parseInt(leftEl.textContent.replace(/,/g, '')) || 0;
			const currentRight = parseInt(rightEl.textContent.replace(/,/g, '')) || 0;

			if (currentLeft !== leftVotes) {
				leftEl.classList.add('updated');
				setTimeout(() => leftEl.classList.remove('updated'), 500);
			}
			if (currentRight !== rightVotes) {
				rightEl.classList.add('updated');
				setTimeout(() => rightEl.classList.remove('updated'), 500);
			}

			if (totalVotes === 0) {
				leftBar.style.width = '50%';
				rightBar.style.width = '50%';
			} else {
				leftBar.style.width = `${leftPercentage}%`;
				rightBar.style.width = `${rightPercentage}%`;
			}

			leftEl.textContent = formatNumber(leftVotes);
			rightEl.textContent = formatNumber(rightVotes);
			leftPctEl.textContent = `${leftPercentage}%`;
			rightPctEl.textContent = `${rightPercentage}%`;

			// è¶‹åŠ¿å›¾ï¼šä»…ç›´æ’­æ—¶åˆ·æ–°ï¼Œæ¯30ç§’ä¸€ä¸ªç‚¹ï¼Œæœ€å¤š30ç‚¹ï¼›åªè®°å½•æœ€æ–°ç¥¨æ•°ï¼Œç”±å®šæ—¶å™¨å†™å…¥
			if (voteHistory.length === 0) { debateStartTime = new Date(); }
			lastVoteForTrend = { time: Date.now(), leftVotes, rightVotes };
			if (!voteTrendIntervalId && typeof startVoteTrendTimer === 'function') startVoteTrendTimer();
			if (typeof updateVoteTrendChart === 'function') updateVoteTrendChart();
		}
		function startVoteTrendTimer() {
			if (voteTrendIntervalId) return;
			voteTrendIntervalId = setInterval(function() {
				if (Date.now() - lastVoteForTrend.time > 90000) return; // 90ç§’æ— æŠ•ç¥¨è§†ä¸ºåœæ’­ï¼Œæš‚åœæ›´æ–°
				voteHistory.push({ timestamp: new Date(), leftVotes: lastVoteForTrend.leftVotes, rightVotes: lastVoteForTrend.rightVotes });
				if (voteHistory.length > VOTE_TREND_MAX_POINTS) voteHistory.splice(0, voteHistory.length - VOTE_TREND_MAX_POINTS);
				if (typeof updateVoteTrendChart === 'function') updateVoteTrendChart();
			}, VOTE_TREND_INTERVAL_MS);
		}
		function stopVoteTrendTimer() {
			if (voteTrendIntervalId) { clearInterval(voteTrendIntervalId); voteTrendIntervalId = null; }
		}

		// æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
		function formatNumber(num) {
			return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
		}

		// åˆå§‹åŒ–WebSocketï¼ˆç”¨äºå®æ—¶æ›´æ–°ï¼‰
		function initWebSocket() {
			try {
				const wsBaseUrl = getAPIBase();
				const baseUrl = new URL(wsBaseUrl);
				const protocol = baseUrl.protocol === 'https:' ? 'wss:' : 'ws:';
				const wsUrl = `${protocol}//${baseUrl.host}/ws`;

				ws = new WebSocket(wsUrl);

				ws.onopen = () => {
					console.log('âœ… WebSocket å·²è¿æ¥');
				};

				ws.onmessage = (event) => {
					try {
						const message = JSON.parse(event.data);
						handleWebSocketMessage(message);
					} catch (error) {
						console.error('WebSocket æ¶ˆæ¯è§£æå¤±è´¥:', error);
					}
				};

				ws.onerror = (error) => {
					console.error('WebSocket é”™è¯¯:', error);
				};

				ws.onclose = () => {
					console.log('WebSocket å·²æ–­å¼€ï¼Œ5ç§’åé‡è¿...');
					setTimeout(() => {
						if (currentStreamId) {
							initWebSocket();
						}
					}, 5000);
				};
			} catch (error) {
				console.error('WebSocket åˆå§‹åŒ–å¤±è´¥:', error);
			}
		}

		// å¤„ç†WebSocketæ¶ˆæ¯
		function handleWebSocketMessage(message) {
			if (message.type === 'votes-updated' || message.type === 'vote-updated') {
				const votes = message.data?.votes || message.data || message;
				const msgStreamId = message.data?.streamId || votes.streamId;
				if (msgStreamId && String(msgStreamId) !== String(currentStreamId)) return;
				// ç›´æ’­ç»“æŸå¹¶å·²è¿”ç»™ç¥¨æ•°åˆ†æåçš„åˆå§‹åŒ–ï¼šæ˜¾ç¤º 0ï¼Œæ¸…ç©ºæœ¬åœ°ç¥¨æ•°/è¶‹åŠ¿å†å²ï¼Œä¸‹æ¬¡ä¸ç´¯è®¡ä¹‹å‰æ•°æ®
				const fromLiveEndReset = message.data?.source === 'live-end-reset';
				if (fromLiveEndReset) {
					voteHistory.length = 0;
					lastVoteForTrend = { time: 0, leftVotes: 0, rightVotes: 0 };
					if (typeof stopVoteTrendTimer === 'function') stopVoteTrendTimer();
				}
				const fromLiveStart = message.data?.source === 'live-start';
				// å¤§å±ç¥¨æ¯”åªè®¤æœ¬åœºï¼šä»…å½“å¸¦ liveSession æ—¶æ‰æ›´æ–°ï¼Œç¥¨æ•°ç®¡ç†æ”¹ã€Œå½“å‰ç¥¨æ•°ã€çš„æ¨é€ä¸å¸¦æœ¬åœºï¼Œç›´æ¥å¿½ç•¥ä¸æ›´æ–°
				const hasSession = votes.liveSessionLeft != null && votes.liveSessionRight != null;
				if (!hasSession && !fromLiveStart && !fromLiveEndReset) {
					// æ— æœ¬åœºæ•°æ®ä¸”éå¼€æ’­/å…³æ’­é‡ç½® â†’ ä¸æ›´æ–°ç¥¨æ¯”ï¼ˆé¿å…è¢«å½“å‰ç¥¨æ•°è¦†ç›–ï¼‰
					return;
				}
				const rawLeft = hasSession ? votes.liveSessionLeft : (fromLiveStart || fromLiveEndReset ? 0 : votes.leftVotes);
				const rawRight = hasSession ? votes.liveSessionRight : (fromLiveStart || fromLiveEndReset ? 0 : votes.rightVotes);
				let leftVotes = (fromLiveStart || fromLiveEndReset) ? 0 : (rawLeft ?? 0);
				let rightVotes = (fromLiveStart || fromLiveEndReset) ? 0 : (rawRight ?? 0);
				if (leftVotes !== undefined && rightVotes !== undefined) {
					const totalVotes = (fromLiveStart || fromLiveEndReset) ? 0 : (votes.totalVotes || (leftVotes + rightVotes));
					const leftPercentage = totalVotes > 0 ? Math.round((leftVotes / totalVotes) * 100) : 50;
					const rightPercentage = totalVotes > 0 ? Math.round((rightVotes / totalVotes) * 100) : 50;
					updateVotesDisplay(leftVotes, rightVotes, totalVotes, leftPercentage, rightPercentage);
				}
				// è¯„å§”æŠ•ç»™è°äº†ï¼šå¤§å±æ˜¾ç¤ºè¯„å§”æŠ•ç¥¨å½’å±
				if (String(votes.streamId) === String(currentStreamId) && Array.isArray(votes.judgeVotes) && votes.judgeVotes.length > 0) {
					votes.judgeVotes.forEach(jv => {
						const judge = judgeState.find(j => j.id === jv.judgeId);
						if (judge) {
							judge.votedSide = jv.votedSide;
							judge.votedVotes = jv.votes;
						}
					});
					renderJudges(judgeState);
				}
			}
			// ğŸ”§ æ–°å¢ï¼šå¤„ç†è¾©è®ºæµç¨‹æ›´æ–°äº‹ä»¶
			else if (message.type === 'debate-flow-updated') {
				const flowData = message.data || message;
				// æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰æµçš„æ›´æ–°
				if (flowData.streamId === currentStreamId && flowData.segments) {
					console.log('ğŸ“¢ æ¥æ”¶åˆ°è¾©è®ºæµç¨‹æ›´æ–°:', flowData);
					DEBATE_SEGMENTS = flowData.segments;
					alert('âœ… è¾©è®ºæµç¨‹å·²æ›´æ–°ï¼');
				}
			}
			// å¤„ç†è¾©è®ºæµç¨‹æ§åˆ¶å‘½ä»¤äº‹ä»¶
			else if (message.type === 'debate-flow-control') {
				const controlData = message.data || message;
				if (controlData.streamId === currentStreamId) {
					console.log('ğŸ“¢ æ¥æ”¶åˆ°æµç¨‹æ§åˆ¶å‘½ä»¤:', controlData.action);
				}
			}
			// å¤„ç†AIçŠ¶æ€æ›´æ–°ï¼šå¯åŠ¨æ—¶å±•ç¤ºAIå†…å®¹ï¼Œåœæ­¢æ—¶éšè—
			else if (message.type === 'aiStatus') {
				const data = message.data || message;
				const streamId = data.streamId;
				const status = data.status;
				if (!streamId || streamId === currentStreamId) {
					const section = document.getElementById('ai-content-section');
					if (section) {
						if (status === 'running') {
							section.style.display = 'block';
							loadAIContentForDisplay(currentStreamId);
						} else {
							section.style.display = 'none';
						}
					}
				}
			}
			// æ”¶åˆ°æ–° AI å†…å®¹æ—¶åˆ·æ–°åˆ—è¡¨ï¼ˆåå°çº¯æ¨¡æ‹Ÿç”Ÿæˆåä¹Ÿä¼šæ¨é€ï¼Œå¤§å±å®æ—¶æ˜¾ç¤ºï¼‰
			else if (message.type === 'newAIContent') {
				const data = message.data || message;
				if (data.streamId === currentStreamId || (!data.streamId && currentStreamId)) {
					loadAIContentForDisplay(currentStreamId);
				}
			}
			// å¤„ç†è¯„å§”ä¿¡æ¯æ›´æ–°äº‹ä»¶
			else if (message.type === 'judges-updated') {
				const data = message.data || message;
				if (data.streamId === currentStreamId && Array.isArray(data.judges) && data.judges.length > 0) {
					judgeState = data.judges.map((j, idx) => ({
						...DEFAULT_JUDGES[idx],
						...j
					}));
					renderJudges(judgeState);
				}
			}
		}

		// å¼€å§‹è‡ªåŠ¨åˆ·æ–°
		function startAutoRefresh() {
			if (refreshTimer) {
				clearInterval(refreshTimer);
			}

			refreshTimer = setInterval(() => {
				if (currentStreamId) {
					loadVotes(currentStreamId, false);
					// AIè¿è¡Œæ—¶æ¯10ç§’åˆ·æ–°AIå†…å®¹
					const section = document.getElementById('ai-content-section');
					if (section && section.style.display !== 'none') {
						loadAIContentForDisplay(currentStreamId);
					}
				}
			}, 5000);
		}

		function initVoteTrendChart() {
			const dom = document.getElementById('vote-trend-chart');
			voteTrendChart = echarts.init(dom);
			initVoteTrendChartOption();
			updateVoteTrendChart();
		}
		function updateVoteTrendChart() {
			if (!voteTrendChart) return;
			const recent = voteHistory.slice(-VOTE_TREND_MAX_POINTS);
			if (recent.length === 0) return;
			const timeLabels = recent.map(item => {
				const date = new Date(item.timestamp);
				const mins = Math.floor((date - debateStartTime) / 1000 / 60);
				const secs = Math.floor((date - debateStartTime) / 1000) % 60;
				return `${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
			});
			const leftData = recent.map(item => item.leftVotes);
			const rightData = recent.map(item => item.rightVotes);
			// åªæ›´æ–°æ•°æ®å’Œ x è½´ï¼Œåˆå¹¶æ¨¡å¼ï¼Œé¿å…æ•´é¡µé‡ç»˜ã€é¡µé¢æŠ–åŠ¨
			voteTrendChart.setOption({
				xAxis: { type: 'category', data: timeLabels, axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } }, axisLabel: { color: 'rgba(255,255,255,0.8)' } },
				yAxis: { max: VOTE_TREND_Y_MAX },
				series: [
					{ data: leftData },
					{ data: rightData }
				]
			}, { notMerge: false, lazyUpdate: true });
		}
		function initVoteTrendChartOption() {
			if (!voteTrendChart) return;
			voteTrendChart.setOption({
				backgroundColor: 'transparent',
				tooltip: { trigger: 'axis' },
				legend: { data: ['æ­£æ–¹', 'åæ–¹'], textStyle: { color: '#fff' } },
				xAxis: { type: 'category', data: [], axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } }, axisLabel: { color: 'rgba(255,255,255,0.8)' } },
				yAxis: { type: 'value', min: 0, max: VOTE_TREND_Y_MAX, axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } }, axisLabel: { color: 'rgba(255,255,255,0.8)' }, splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }, scale: true },
				series: [
					{ name: 'æ­£æ–¹', type: 'line', smooth: true, data: [] },
					{ name: 'åæ–¹', type: 'line', smooth: true, data: [] }
				]
			});
		}
		function showVoteTrendChart() {
			const overlay = document.getElementById('chart-overlay');
			overlay.style.display = 'flex';
			if (!voteTrendChart) initVoteTrendChart(); else updateVoteTrendChart();
			chartShown = true;
		}
		function hideVoteTrendChart() {
			const overlay = document.getElementById('chart-overlay');
			overlay.style.display = 'none';
		}

		// æ˜¾ç¤º/éšè—å‡½æ•°
		function showLoading() {
			const mainContent = document.getElementById('main-content');
			if (mainContent) {
				mainContent.style.display = 'none';
			}
		}

		function hideLoading() {
			// no-op
		}

		function showError(message) {
			document.getElementById('error').textContent = message;
			document.getElementById('error').style.display = 'block';
		}

		function hideError() {
			document.getElementById('error').style.display = 'none';
		}
	</script>
</body>
</html>
